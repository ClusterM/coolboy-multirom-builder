# COOLBOY Multirom Builder

This is a toolset that allows you to create multirom images for cheap COOLBOY/MINDKIDS (and clones) Famicom cartridges (mappers 268.0 and 268.1). This ROM can be run on emulator or written to a real hardware.

It can:
* Automatically combine up to 1536 games into single binary which can be written to cheap COOLBOY cartridge
* Create nice menu where you can easily select a game
* Alphabetically sort games if you need it
* Use your own image for the menu header and other customizations
* Remember last played game and keep up to 15 game saves into flash memory on a self-writable cartridges with PRG-RAM
* Run built-in hardware tests
* Show build and hardware info
* Add up to three hidden ROMs

How it works (first method):
1. Convert images to a NES assets using the [NesTiler](https://github.com/ClusterM/NesTiler) tool.
2. Create a text file with a list of files and/or directories with the ROMs, optionally you can specify game names for corresponding menu entries. 
3. Run **coolboy-combiner** with "**prepare**" option, it will automatically use the best way to fit games data in the target ROM and create "**games.asm**" file and offsets file. First one contains game names and register values for game loader menu. Second file contains info with addresses of data for every game in the final ROM.
4. Compile assembly files using [nesasm CE](https://github.com/ClusterM/nesasm). It will create .nes file with the loader menu. But it will not contain games data. You can tune loader menu using command line options and defines: header image, background stars behavior, sounds, etc.
5. Combine loader menu and games into one file (.nes, .unf or .bin) using **coolboy-combiner** with "**combine**" option and offsets file generated by step 2. Done.

Alternative method (easier and faster):
1. Convert images to a NES assets using the [NesTiler](https://github.com/ClusterM/NesTiler) tool.
2. Create a text file with a list of files and/or directories with the ROMs, optionally you can specify game names for corresponding menu entries.
3. Run **coolboy-combiner** with "**build**" option, it will automaticaly fit games, compile assembly files using [nesasm CE](https://github.com/ClusterM/nesasm) and combine everything into one file (.nes, .unf or .bin).

It sounds a bit complicated but this toolset contains all tools and bundled with scripts for automatic execution: Makefile and .bat file (for Windows users). Makefile can be used with [Make](https://www.gnu.org/software/make/) tool to automatize the whole process. Just run:

`make nes GAMES=games.list`

Where "games.list" is your config file with a game list. Also, you can tune some options. Enable saves using self-writable flash memory:

`make nes GAMES=games.list SAVES=1`

Or change header image:

`make nes GAMES=games.list SAVES=1 MENU_HEADER=menu_example.png`

Use $5xxx registers instead of $6xxx and write to output.nes:

`make nes GAMES=games.list MINDKIDS=1 OUTPUT_NES20=output.nes`

Save output ROM as UNIF file:

`make unif GAMES=games.list OUTPUT_UNIF=output.unf`

Check **Makefile** for all options. Windows users can install Make using [msys2](https://www.msys2.org/) or just use **build.bat** file but it's not very custimizable.

Windows users can use "**build.bat**" batch file. Default game list file is "**configs/games.list**".

Now let me talk you much more info.


## Which cartridges are supported, how to select which cartridge to buy

There are many versions of COOLBOY cartridges and clones. Actually most of them are not "COOLBOY", it's just a name of the first cartridges with this chip.

You can find modifications:
* **With a different CHR size**. Some cartridges has only 128KB of RAM for CHR data and some 256KB. So 128KB version can't run many cool games with CHR size >128KB. You can easily detect amount of CHR RAM after looking at games list. If it has at least one game with large CHR, cartridge has 256KB. Example games: Megaman/Rockman 5, Earthbound Zero, Kirby's Adventure
* **With a different flash size**. Most cartridges has 32MBytes of flash memory but it's possible to find much more rare cartridges with less memory size. 32MBytes is maximum available size.
* **With and without additional PRG RAM chip**. It's required by some games like The Legend of Zelda, Jurassic Park, etc. So if cartridge contains those games, it has PRG RAM chip. Also, it's possible to solder this chip manually usually.
* **With and without battery**. Battery is used to keep data in PRG RAM chip even after console is turned off. It's used to save games progress. So if cartridge has battery, it also has PRG-RAM chip. There is no way to detect present of battery but usually seller can say it, also check product description in shop.
* **With a directly writable and non-writable flash memory**. Some new cartridges can be rewrited directly without additional soldering and some not. Direct rewrite will allow you not only rewrite cartridge's flash memory using very simple way but it will also allow to keep many game saves in cartridge's memory (if PRG RAM chip exists). Originally game's progress will be erased if any other game started that uses PRG RAM even if battery present. There is no way to know which cartridge has this feature but seems like it's all cartridges produced by "MINDKIDS". So if you can look at cartridge's board, check it for "MINDKIDS" label.
* **With a different register addresses**. Most cartridges has registers at $600x addresses but some cartridges has them at $500x. This toolset supports both versions, so you don't need to care about it.

So it's recommended to search for MINDKIDS cartridges with battery.


## Which games are supported

COOLBOY supports games with **NROM** (mapper #0) and **MMC3** (mapper #4) mappers only. NROM is used by games without any mapper and MMC3 is most popular mapper, so games support is good but not perfect. Also most non-MMC3 games can be patched to run on MMC3 without any problem. Also make sure that PRG RAM and CHR size requirements are met.

And one more thing with some weird buggy games. COOLBOY always uses writable CHR RAM even original game uses CHR ROM and it has not 'read-only' mode. So if game with CHR ROM writes to ROM for some weird reason, CHR data will be corrupted. It can be fixed using patches for ROMs. Example game: Cowboy Kid.

Also please note that PRG RAM is not working correctly on *original* Famicoms and AV Famicoms without additional hardware modification of cartridge.


## Game list format

It's just a text file. Lines started with semicolon are comments. Other lines has format:

    <path_to_filename> [| <menu name>]
    
So each line is a path to a ROM with optional name which will be used in menu. Example:

    roms/Adventure Island (U) [!].nes | ADVENTURE ISLAND
    roms/Adventure Island II (U) [!].nes | ADVENTURE ISLAND 2
    roms/Adventure Island III (U) [!].nes | ADVENTURE ISLAND 3

Use tailing "/" to add whole directory:

    roms/
    
If menu name is not specified it will be based on a filename. Maximum length for menu entry is 29 symbols.

You can use "?" symbol as menu name to add hidden ROMs:

    spec/sram.nes | ? 
    spec/controller.nes | ? 

First hidden ROM will be started while holding Up+A+B at startup. Second one will be started while holding Down+A+B at start. I'm using it to add some hardware tests. Also you can add third hidden ROM, it will be started using the Konami Code in games menu :)

All games are alphabetically sorted by default so you don't need to care about games order. But if you are using custom order, you can use "-" symbol to add separators between games:

    roms/filename1.nes
    roms/filename2.nes
    -
    roms/filename3.nes
    roms/filename4.nes
    
You can disable sorting and enable custom order using NOSORT=1 option when running Make. Or just add "!NOSORT" line to a game list file.

Check [configs/games.list](configs/games.list) for example.


## Using menu

Buttons:
* **Up** - move to previous game
* **Down** - move to next game
* **Right** - jump 10 games forward
* **Left** - jump 10 games backward
* **Start** - start selected game
* **A** - same, start selected game
* **B** - not used

Special combinations:
* Hold **Select** on start to show some build and hardware info
* Hold **Select**+**A**+**B** on start RAM tests, it will test PRG RAM and 256KB of CHR data
* Hold **Left**+**Up**+**Select**+**Start** on start to erase all saved data
* Hold **Up**+**A**+**B** on start to start first hidden ROM
* Hold **Down**+**A**+**B** on start to start second hidden ROM
* Press **Up**, **Up**, **Down**, **Down**, **Left**, **Right**, **Left**, **Right**, **B**, **A** (the Konami code) to start third hidden ROM


## About flash saving system

When cartridge with a directly writable flash memory used (/WE and /OE pins are connected to the mapper), it's possible to use this memory as additional storage. If Make started with "SAVES=1" option, the last two sectors of flash memory (256KBytes) will be reserved for it. This memory will be used to store cursor position and progress of "battery-backed" games (even if cartridge has no battery but you'll need to press reset to save the progress in this case). Please note that flash memory is not rewrited every time. New data will be writed to free space on active sector marked by signature. When active sector is full, all actual data will be moved to the second one. User will be warned to keep power on.


## Donate

https://www.donationalerts.com/r/clustermeerkat

https://boosty.to/cluster
